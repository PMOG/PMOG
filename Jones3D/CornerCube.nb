(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     84801,       1790]
NotebookOptionsPosition[     84325,       1769]
NotebookOutlinePosition[     84657,       1784]
CellTagsIndexPosition[     84614,       1781]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SphericalUnit", "[", 
    RowBox[{"\[Theta]_", ",", "\[Phi]_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"Cos", "[", "\[Phi]", "]"}], 
      RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
     RowBox[{
      RowBox[{"Sin", "[", "\[Phi]", "]"}], 
      RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", 
     RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SphericalBase", "[", 
    RowBox[{"\[Theta]_", ",", "\[Phi]_", ",", "\[Psi]_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Cos", "[", "\[Phi]", "]"}], 
         RowBox[{"Cos", "[", "\[Theta]", "]"}]}], ",", 
        RowBox[{"-", 
         RowBox[{"Sin", "[", "\[Phi]", "]"}]}], ",", 
        RowBox[{
         RowBox[{"Cos", "[", "\[Phi]", "]"}], 
         RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Sin", "[", "\[Phi]", "]"}], 
         RowBox[{"Cos", "[", "\[Theta]", "]"}]}], ",", 
        RowBox[{"Cos", "[", "\[Phi]", "]"}], ",", 
        RowBox[{
         RowBox[{"Sin", "[", "\[Phi]", "]"}], 
         RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Sin", "[", "\[Theta]", "]"}]}], ",", "0", ",", 
        RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "}"}]}], "}"}], ".", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cos", "[", "\[Psi]", "]"}], ",", 
        RowBox[{"-", 
         RowBox[{"Sin", "[", "\[Psi]", "]"}]}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Sin", "[", "\[Psi]", "]"}], ",", 
        RowBox[{"Cos", "[", "\[Psi]", "]"}], ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Stokes", "[", 
    RowBox[{"P_", ",", "Efield_", ",", "x_", ",", "r_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "S0", ",", "S1", ",", "S2", ",", "S3", ",", "A", ",", "B", ",", 
       "\[Phi]", ",", "Q", ",", "\[CapitalSigma]", ",", "V", ",", "p", ",", 
       "s", ",", "Ux", ",", "Uy", ",", "Uxx", ",", "Uyy", ",", "Uxy"}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Q", ",", "\[CapitalSigma]", ",", "V"}], "}"}], "=", 
       RowBox[{"SingularValueDecomposition", "[", "P", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"p", "=", 
       RowBox[{"Q", ".", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"s", "=", 
       RowBox[{"Q", ".", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Ux", ",", "Uy"}], "}"}], "=", 
       RowBox[{"Normalize", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"p", ",", "s"}], "}"}], ".", 
         RowBox[{"(", 
          RowBox[{"P", ".", "Efield"}], ")"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Uxx", "=", 
       RowBox[{
        RowBox[{"Conjugate", "[", "Ux", "]"}], "*", "Ux"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Uyy", "=", 
       RowBox[{
        RowBox[{"Conjugate", "[", "Uy", "]"}], "*", "Uy"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Uxy", "=", 
       RowBox[{
        RowBox[{"Conjugate", "[", "Ux", "]"}], "*", "Uy"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"S0", "=", 
       RowBox[{"Re", "[", 
        RowBox[{"Uxx", "+", "Uyy"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"S1", "=", 
       RowBox[{"Re", "[", 
        RowBox[{"Uxx", "-", "Uyy"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"S2", "=", 
       RowBox[{"2", 
        RowBox[{"Re", "[", "Uxy", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"S3", "=", 
       RowBox[{"2", 
        RowBox[{"Im", "[", "Uxy", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"A", "=", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"(", 
          RowBox[{"S0", "+", 
           RowBox[{"Sqrt", "[", 
            RowBox[{
             RowBox[{"S1", "^", "2"}], "+", 
             RowBox[{"S2", "^", "2"}]}], "]"}]}], ")"}], "]"}], "*", "r"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"B", "=", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"(", 
          RowBox[{"S0", "-", 
           RowBox[{"Sqrt", "[", 
            RowBox[{
             RowBox[{"S1", "^", "2"}], "+", 
             RowBox[{"S2", "^", "2"}]}], "]"}]}], ")"}], "]"}], "*", "r"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"\[Phi]", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"S1", "\[Equal]", "0"}], "&"}], "S2"}], "\[Equal]", "0"}],
          ",", "0", ",", 
         RowBox[{
          RowBox[{"ArcTan", "[", 
           RowBox[{"S1", ",", "S2"}], "]"}], "/", "2"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Graphics", "[", 
       RowBox[{"Rotate", "[", 
        RowBox[{
         RowBox[{"Circle", "[", 
          RowBox[{"x", ",", 
           RowBox[{"{", 
            RowBox[{"A", ",", "B"}], "}"}]}], "]"}], ",", "0"}], "]"}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReflectRefract", "[", 
    RowBox[{"u_", ",", "k0_", ",", "nt_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "s0", ",", "p0", ",", "s1", ",", "p1", ",", "k1", ",", "s2", ",", "p2", 
       ",", "k2", ",", "Q0", ",", "Q1", ",", "Q2", ",", "ci", ",", "ct", ",", 
       "r", ",", "t", ",", "rp", ",", "tp", ",", "rs", ",", "ts", ",", "P1", 
       ",", "P2", ",", "Rays"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"k0", ".", "u"}], "]"}], "\[Equal]", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Normal", " ", "incidence"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"k1", "=", 
         RowBox[{"k0", "-", 
          RowBox[{"2", 
           RowBox[{"(", 
            RowBox[{"k0", ".", "u"}], ")"}], "u"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"k2", "=", "k0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Fresnel", " ", "Coefficients"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"r", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"nt", "-", "1"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nt", "+", "1"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"t", "=", 
         RowBox[{"2", "/", 
          RowBox[{"(", 
           RowBox[{"nt", "+", "1"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"P1", "=", 
         RowBox[{
          RowBox[{"r", "*", 
           RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "r"}], ")"}], 
           RowBox[{"Outer", "[", 
            RowBox[{"Times", ",", "u", ",", "u"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"P2", "=", 
         RowBox[{
          RowBox[{"t", "*", 
           RowBox[{"IdentityMatrix", "[", "3", "]"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "t"}], ")"}], 
           RowBox[{"Outer", "[", 
            RowBox[{"Times", ",", "u", ",", "u"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Rays", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"k0", ",", "k1", ",", "k2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{"Rays", ",", "P1", ",", "P2"}], "}"}], "]"}], ";"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", "Else", "*)"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Oblique", " ", "incidence"}], "*)"}], "\[IndentingNewLine]", 
       
       RowBox[{"(*", 
        RowBox[{"k1", ":", " ", 
         RowBox[{"Reflected", " ", "ray"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"k1", "=", 
         RowBox[{"k0", "-", 
          RowBox[{"2", 
           RowBox[{"(", 
            RowBox[{"k0", ".", "u"}], ")"}], "u"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"s0", "=", 
         RowBox[{"Normalize", "[", 
          RowBox[{"Cross", "[", 
           RowBox[{"k0", ",", "k1"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"s1", "=", "s0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"p0", "=", 
         RowBox[{"Cross", "[", 
          RowBox[{"k0", ",", "s0"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"p1", "=", 
         RowBox[{"Cross", "[", 
          RowBox[{"k1", ",", "s1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Q0", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"s0", ",", "p0", ",", "k0"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Q1", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"s1", ",", "p1", ",", "k1"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"k2", ":", " ", 
          RowBox[{"Refracted", " ", "ray"}]}], "*)"}], "\[IndentingNewLine]", 
        
        RowBox[{"ci", "=", 
         RowBox[{"Abs", "[", 
          RowBox[{"u", ".", "k0"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ct", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "-", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "-", 
              RowBox[{"ci", "^", "2"}]}], ")"}], "/", 
            RowBox[{"nt", "^", "2"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"k2", "=", 
         RowBox[{
          RowBox[{"k0", "/", "nt"}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"ct", "-", 
             RowBox[{"ci", "/", "nt"}]}], ")"}], 
           RowBox[{"Sign", "[", 
            RowBox[{"k0", ".", "u"}], "]"}], "u"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"s2", "=", "s0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"p2", "=", 
         RowBox[{"Cross", "[", 
          RowBox[{"k2", ",", "s2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Q2", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"s2", ",", "p2", ",", "k2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Fresnel", " ", "Coefficients"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"rs", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"nt", "*", "ci"}], "-", "ct"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"nt", "*", "ci"}], "+", "ct"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ts", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"2", "ci"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"nt", "*", "ci"}], "+", "ct"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rp", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"ci", "-", 
            RowBox[{"nt", "*", "ct"}]}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"ci", "+", 
            RowBox[{"nt", "*", "ct"}]}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tp", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"2", "ci"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"ci", "+", 
            RowBox[{"nt", "*", "ct"}]}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Polarization", " ", "Matrices"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"P1", "=", 
         RowBox[{"Q1", ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{"rs", ",", "rp", ",", "1"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", "Q0", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"P2", "=", 
         RowBox[{"Q2", ".", 
          RowBox[{"DiagonalMatrix", "[", 
           RowBox[{"{", 
            RowBox[{"ts", ",", "tp", ",", "1"}], "}"}], "]"}], ".", 
          RowBox[{"Transpose", "[", "Q0", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Rays", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"k0", ",", "k1", ",", "k2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{"Rays", ",", "P1", ",", "P2"}], "}"}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EPS", "=", "1*^-6"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"B", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", 
          RowBox[{"-", "1"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", 
          RowBox[{"-", "1"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0"}], "}"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", "2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"2", ",", "0", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", 
          RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"Quiet", "@", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Efield", "=", 
        RowBox[{
         RowBox[{"SphericalBase", "[", 
          RowBox[{"\[Theta]0", ",", "\[Phi]0", ",", "0"}], "]"}], ".", 
         RowBox[{"{", 
          RowBox[{"Ex", ",", 
           RowBox[{"Ey", "*", 
            RowBox[{"Exp", "[", 
             RowBox[{"I", "*", "\[Delta]"}], "]"}]}], ",", "0"}], "}"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"S0", "=", 
        RowBox[{"SphericalBase", "[", 
         RowBox[{"\[Theta]1", ",", "\[Phi]1", ",", "\[Psi]1"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"M1", "=", 
        RowBox[{"S0", ".", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"M2", "=", 
        RowBox[{"S0", ".", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"M3", "=", 
        RowBox[{"S0", ".", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"u1", ",", "v1", ",", "w1"}], "}"}], "=", 
        RowBox[{"Transpose", "[", "M1", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"u2", ",", "v2", ",", "w2"}], "}"}], "=", 
        RowBox[{"Transpose", "[", "M2", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"u3", ",", "v3", ",", "w3"}], "}"}], "=", 
        RowBox[{"Transpose", "[", "M3", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"S", "=", 
        RowBox[{"Join", "[", 
         RowBox[{"B", ",", 
          RowBox[{"{", 
           RowBox[{"M1", ",", "M2", ",", "M3"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"r1", "=", 
        RowBox[{"S0", ".", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "0", ",", "0"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"r2", "=", 
        RowBox[{"S0", ".", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "1"}], ",", "0"}], "}"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"r3", "=", 
        RowBox[{"S0", ".", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", 
           RowBox[{"-", "1"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"b1", ",", "b2", ",", "b3"}], "}"}], "=", 
        RowBox[{"2", 
         RowBox[{"IdentityMatrix", "[", "3", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"centers", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "b3"}], ",", 
          RowBox[{"-", "b2"}], ",", 
          RowBox[{"-", "b1"}], ",", "b1", ",", "b2", ",", "b3", ",", "r1", 
          ",", "r2", ",", "r3"}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"n0", "=", "2"}], ";", "\[IndentingNewLine]", 
       RowBox[{"refidx", "=", 
        RowBox[{"{", 
         RowBox[{
         "n0", ",", "n0", ",", "n0", ",", "n0", ",", "n0", ",", "n0", ",", 
          "n1", ",", "n2", ",", "n3"}], "}"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"x0Bundle", "=", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"Sqrt", "[", "2", "]"}], ",", "1"}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"x0", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"x0Bundle", "+", 
             RowBox[{
              RowBox[{"SphericalBase", "[", 
               RowBox[{"\[Theta]0", ",", "\[Phi]0", ",", "0"}], "]"}], ".", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"#1", "*", 
                    RowBox[{"Sin", "[", "#2", "]"}]}], ",", 
                   RowBox[{"#1", "*", 
                    RowBox[{"Cos", "[", "#2", "]"}]}], ",", "0"}], "}"}], 
                 "&"}], "@@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Rbundle", "*", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "+", 
                    RowBox[{"Boole", "[", 
                    RowBox[{"nrays1", ">", "1"}], "]"}]}], ")"}], "/", 
                    RowBox[{"(", "nrays1", ")"}]}]}], ",", 
                  RowBox[{"2", "\[Pi]", "*", 
                   RowBox[{"j", "/", 
                    RowBox[{"(", "nrays2", ")"}]}]}]}], "}"}]}], ")"}]}]}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", 
              RowBox[{"nrays1", "-", "1"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "0", ",", 
              RowBox[{"nrays2", "-", "1"}]}], "}"}]}], "]"}], ",", "1"}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"path", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "#", "}"}], "&"}], "/@", "x0"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"k0", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"SphericalUnit", "[", 
           RowBox[{"\[Theta]0", ",", "\[Phi]0"}], "]"}], ",", 
          RowBox[{"Length", "[", "x0", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"P", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"IdentityMatrix", "[", "3", "]"}], ",", 
          RowBox[{"Length", "[", "x0", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Pobs", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"m", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"m", "\[LessEqual]", 
          RowBox[{"Min", "[", 
           RowBox[{"1000", ",", 
            RowBox[{"Length", "[", "x0", "]"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ki", "=", 
           RowBox[{"k0", "[", 
            RowBox[{"[", "m", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"xi", "=", 
           RowBox[{"x0", "[", 
            RowBox[{"[", "m", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"j", "=", "7"}], ";", "\[IndentingNewLine]", 
          RowBox[{"its", "=", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"its", "<", "100"}], ")"}], "&&", 
             RowBox[{"(", 
              RowBox[{"j", ">", "6"}], ")"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"L", "=", 
              RowBox[{"MapThread", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ki", ".", "#1"}], "\[Equal]", "0"}], ",", 
                   RowBox[{"-", "100000"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#2", "-", "xi"}], ")"}], ".", "#1"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"ki", ".", "#1"}], ")"}]}]}], "]"}], "&"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"S", "[", 
                   RowBox[{"[", 
                    RowBox[{";;", ",", ";;", ",", "3"}], "]"}], "]"}], ",", 
                  "centers"}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"d", "=", 
              RowBox[{
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"xi", "+", 
                    RowBox[{"#", "*", "ki"}]}], ")"}], "&"}], ",", "L"}], 
                "]"}], "-", "centers"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"q", "=", 
              RowBox[{"MapThread", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Norm", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Inverse", "[", "#1", "]"}], ".", "#2"}], ",", 
                    "Infinity"}], "]"}], "<", "1"}], ")"}], "&"}], ",", 
                RowBox[{"{", 
                 RowBox[{"S", ",", "d"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"LL", "=", 
              RowBox[{"Pick", "[", 
               RowBox[{"L", ",", "q", ",", "True"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"j", "=", 
              RowBox[{"Position", "[", 
               RowBox[{"L", ",", 
                RowBox[{"Min", "[", 
                 RowBox[{"Select", "[", 
                  RowBox[{"LL", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"#", ">", "EPS"}], ")"}], "&"}]}], "]"}], "]"}]}],
                "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "j", "]"}], "\[Equal]", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"its", "=", "100"}], ";"}], "\[IndentingNewLine]", 
               RowBox[{"(*", "Else", "*)"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"j", "=", 
                 RowBox[{"Part", "[", 
                  RowBox[{"j", ",", "1", ",", "1"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"xi", "=", 
                 RowBox[{"xi", "+", 
                  RowBox[{
                   RowBox[{"L", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "*", "ki"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"path", "[", 
                  RowBox[{"[", "m", "]"}], "]"}], "=", 
                 RowBox[{"Append", "[", 
                  RowBox[{
                   RowBox[{"path", "[", 
                    RowBox[{"[", "m", "]"}], "]"}], ",", "xi"}], "]"}]}], ";",
                 "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"j", ">", "6"}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Rays", ",", "P1", ",", "P2"}], "}"}], "=", 
                    RowBox[{"ReflectRefract", "[", 
                    RowBox[{
                    RowBox[{"S", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", ";;", ",", "3"}], "]"}], "]"}], ",", 
                    "ki", ",", 
                    RowBox[{"refidx", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", " ", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"P", "[", 
                    RowBox[{"[", "m", "]"}], "]"}], "=", 
                    RowBox[{"P1", ".", 
                    RowBox[{"P", "[", 
                    RowBox[{"[", "m", "]"}], "]"}]}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"ki", "=", 
                    RowBox[{"Rays", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "2"}], "]"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"P", "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{"P", ",", 
                    RowBox[{"P2", ".", 
                    RowBox[{"P", "[", 
                    RowBox[{"[", "m", "]"}], "]"}]}]}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"k0", "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{"k0", ",", 
                    RowBox[{"Rays", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", ",", "3"}], "]"}], "]"}]}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"x0", "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{"x0", ",", "xi"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"path", "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{"path", ",", 
                    RowBox[{"{", "xi", "}"}]}], "]"}]}], ";"}]}], 
                 "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]",
               "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"its", "=", 
              RowBox[{"its", "+", "1"}]}], ";"}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Pobs", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "=", 
           RowBox[{"Append", "[", 
            RowBox[{
             RowBox[{"Pobs", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", 
             RowBox[{"Stokes", "[", 
              RowBox[{
               RowBox[{"P", "[", 
                RowBox[{"[", "m", "]"}], "]"}], ",", "Efield", ",", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "}"}], ".", 
                RowBox[{"Inverse", "[", 
                 RowBox[{"S", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}], ".", "xi"}], ",", 
               RowBox[{"Rbundle", "/", 
                RowBox[{"(", 
                 RowBox[{"4", 
                  RowBox[{"Sqrt", "[", 
                   RowBox[{"nrays1", "*", "nrays2"}], "]"}]}], ")"}]}]}], 
              "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"m", "=", 
           RowBox[{"m", "+", "1"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Show", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Graphics3D", "[", 
              RowBox[{"{", 
               RowBox[{"Red", ",", 
                RowBox[{"Arrow", "[", "#", "]"}]}], "}"}], "]"}], "&"}], "/@", 
            RowBox[{"(", "path", ")"}]}], ",", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Graphics3D", "[", 
              RowBox[{"{", 
               RowBox[{"Black", ",", 
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{"r1", ",", 
                   RowBox[{"r1", "+", "w1"}]}], "}"}], "]"}]}], "}"}], "]"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"Graphics3D", "[", 
              RowBox[{"{", 
               RowBox[{"Black", ",", 
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{"r2", ",", 
                   RowBox[{"r2", "+", "w2"}]}], "}"}], "]"}]}], "}"}], "]"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"Graphics3D", "[", 
              RowBox[{"{", 
               RowBox[{"Black", ",", 
                RowBox[{"Arrow", "[", 
                 RowBox[{"{", 
                  RowBox[{"r3", ",", 
                   RowBox[{"r3", "+", "w3"}]}], "}"}], "]"}]}], "}"}], "]"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"ParametricPlot3D", "[", 
              RowBox[{
               RowBox[{"r1", "+", 
                RowBox[{"\[Lambda]", "*", "u1"}], "+", 
                RowBox[{"\[Mu]", "*", "v1"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Lambda]", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Mu]", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
               RowBox[{"PlotStyle", "\[Rule]", 
                RowBox[{"Directive", "[", 
                 RowBox[{"Red", ",", 
                  RowBox[{"Opacity", "[", "0.5", "]"}]}], "]"}]}]}], "]"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"ParametricPlot3D", "[", 
              RowBox[{
               RowBox[{"r2", "+", 
                RowBox[{"\[Lambda]", "*", "u2"}], "+", 
                RowBox[{"\[Mu]", "*", "v2"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Lambda]", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Mu]", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
               RowBox[{"PlotStyle", "\[Rule]", 
                RowBox[{"Directive", "[", 
                 RowBox[{"Green", ",", 
                  RowBox[{"Opacity", "[", "0.5", "]"}]}], "]"}]}]}], "]"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"ParametricPlot3D", "[", 
              RowBox[{
               RowBox[{"r3", "+", 
                RowBox[{"\[Lambda]", "*", "u3"}], "+", 
                RowBox[{"\[Mu]", "*", "v3"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Lambda]", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Mu]", ",", 
                 RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
               RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
               RowBox[{"PlotStyle", "\[Rule]", 
                RowBox[{"Directive", "[", 
                 RowBox[{"Blue", ",", 
                  RowBox[{"Opacity", "[", "0.5", "]"}]}], "]"}]}]}], "]"}]}], 
            "\[IndentingNewLine]", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "2"}], ",", "2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "2"}], ",", "2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "2"}], ",", "2"}], "}"}]}], "}"}]}], ",", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"AxesLabel", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"\"\<x\>\"", ",", "\"\<y\>\"", ",", "\"\<z\>\""}], 
           "}"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nrays1", ",", "8"}], "}"}], ",", "1", ",", "10", ",", "1"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nrays2", ",", "8"}], "}"}], ",", "1", ",", "10", ",", "1"}], 
    "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Rbundle", ",", "0.1"}], "}"}], ",", "0.1", ",", "1"}], "}"}], 
   ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Ex", ",", "1"}], "}"}], ",", "0", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Ey", ",", "1"}], "}"}], ",", "0", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Delta]", ",", 
       RowBox[{"\[Pi]", "/", "2"}]}], "}"}], ",", "0", ",", 
     RowBox[{"2", "\[Pi]"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Theta]0", ",", 
       RowBox[{
        RowBox[{"\[Pi]", "/", "2"}], "+", 
        RowBox[{"ArcTan", "[", 
         RowBox[{"1", "/", 
          RowBox[{"Sqrt", "[", "2", "]"}]}], "]"}]}]}], "}"}], ",", "0", ",", 
     "\[Pi]"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Phi]0", ",", 
       RowBox[{"3", 
        RowBox[{"\[Pi]", "/", "2"}]}]}], "}"}], ",", "0", ",", 
     RowBox[{"2", "\[Pi]"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Theta]1", ",", "0"}], "}"}], ",", "0", ",", "\[Pi]"}], "}"}],
    ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Phi]1", ",", 
       RowBox[{"\[Pi]", "/", "4"}]}], "}"}], ",", "0", ",", 
     RowBox[{"2", "\[Pi]"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Psi]1", ",", "0"}], "}"}], ",", "0", ",", 
     RowBox[{"2", "\[Pi]"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n1", ",", "1.5"}], "}"}], ",", "0", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n2", ",", "1.5"}], "}"}], ",", "0", ",", "2"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n3", ",", "1.5"}], "}"}], ",", "0", ",", "2"}], "}"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.695663309243862*^9, 3.695663320497797*^9}, {
   3.695663559564149*^9, 3.6956637692684917`*^9}, {3.695663806956051*^9, 
   3.695663917993663*^9}, {3.6956639795915318`*^9, 3.695663999730899*^9}, {
   3.69566404212313*^9, 3.6956640507259808`*^9}, 3.6956641230467453`*^9, {
   3.695664160392598*^9, 3.695664172639114*^9}, {3.695664372433238*^9, 
   3.695664403180629*^9}, {3.695664531063369*^9, 3.695664549953582*^9}, {
   3.6956648050006104`*^9, 3.695664809857439*^9}, {3.6956648585020933`*^9, 
   3.695664862222844*^9}, {3.695664913885857*^9, 3.6956649298115063`*^9}, {
   3.6956650620479517`*^9, 3.6956650658229847`*^9}, {3.695665254046226*^9, 
   3.69566531093364*^9}, {3.695665342408135*^9, 3.6956653919167757`*^9}, {
   3.6956671901671877`*^9, 3.6956674786382713`*^9}, {3.695667522829321*^9, 
   3.695667532852387*^9}, 3.695667618381579*^9, {3.695667668215263*^9, 
   3.695667683347299*^9}, {3.6956677464492073`*^9, 3.695667792184722*^9}, {
   3.695676150977611*^9, 3.69567617995853*^9}, {3.6956773923857403`*^9, 
   3.695677395632348*^9}, 3.695677547639853*^9, {3.695678111360485*^9, 
   3.6956781484599333`*^9}, {3.695678209224308*^9, 3.6956782193961897`*^9}, 
   3.695678258481763*^9, {3.6956783235324183`*^9, 3.69567835935655*^9}, {
   3.695678402030529*^9, 3.695678402436788*^9}, {3.695681384365377*^9, 
   3.695681393846143*^9}, {3.6956857971975117`*^9, 3.695685798378562*^9}, {
   3.695688472681122*^9, 3.69568849324151*^9}, {3.695689120418659*^9, 
   3.695689137362965*^9}, {3.695689185482458*^9, 3.69568967474631*^9}, {
   3.695689719459695*^9, 3.695689983919797*^9}, {3.69569011109195*^9, 
   3.6956901333471117`*^9}, {3.695690215778777*^9, 3.6956902288388042`*^9}, {
   3.695690273211533*^9, 3.6956903471780777`*^9}, {3.695690457100395*^9, 
   3.695690610466384*^9}, {3.69569069883687*^9, 3.695690956178089*^9}, {
   3.695691023963522*^9, 3.6956910635159903`*^9}, {3.6956911589771338`*^9, 
   3.695691213576782*^9}, {3.695691729510457*^9, 3.695691805383651*^9}, {
   3.695691898159727*^9, 3.695691918051593*^9}, {3.695692008787616*^9, 
   3.695692010465747*^9}, {3.6956921639574614`*^9, 3.695692231135741*^9}, 
   3.695692455125339*^9, {3.695692818084531*^9, 3.6956929813075247`*^9}, {
   3.695693025560192*^9, 3.695693082134879*^9}, {3.695693113023305*^9, 
   3.69569315276145*^9}, {3.695693216285404*^9, 3.6956933642527027`*^9}, {
   3.695693429231073*^9, 3.6956934504262247`*^9}, {3.695693527999262*^9, 
   3.695693529716906*^9}, {3.695693640074473*^9, 3.695693782960374*^9}, {
   3.6956939041067133`*^9, 3.6956940163909397`*^9}, {3.695694091473597*^9, 
   3.695694117643962*^9}, {3.69569418296875*^9, 3.6956941940456877`*^9}, {
   3.695694342798766*^9, 3.6956944264062757`*^9}, {3.695694481614994*^9, 
   3.695694645966422*^9}, {3.6956946866392527`*^9, 3.695694717835547*^9}, {
   3.695694920503064*^9, 3.695694936524234*^9}, 3.695694989750807*^9, {
   3.695695181842469*^9, 3.6956952591171017`*^9}, {3.695697261829194*^9, 
   3.695697265720312*^9}, {3.695697377371298*^9, 3.6956973803245897`*^9}, {
   3.6956975061787167`*^9, 3.695697508960781*^9}, {3.6956976732418633`*^9, 
   3.6956976750327168`*^9}, 3.695698238502033*^9, {3.695698276197134*^9, 
   3.695698290942853*^9}, {3.695698358518251*^9, 3.695698367175702*^9}, {
   3.695698473286996*^9, 3.6956985183863783`*^9}, {3.695698604783638*^9, 
   3.695698621068151*^9}, {3.69569871931518*^9, 3.695698742189746*^9}, {
   3.695698779046997*^9, 3.6956988658224087`*^9}, {3.6956989353731937`*^9, 
   3.695698937040975*^9}, {3.6956989989367037`*^9, 3.695699003470264*^9}, 
   3.6956993868234177`*^9, 3.695699719896929*^9, {3.6956998986799717`*^9, 
   3.6956999034891033`*^9}, 3.695700118388315*^9, {3.695700363667239*^9, 
   3.6957003707286053`*^9}, {3.695700488665433*^9, 3.695700534133944*^9}, {
   3.695700596453979*^9, 3.6957006139013577`*^9}, {3.6957007051625023`*^9, 
   3.6957007279416237`*^9}, {3.6957007587947273`*^9, 3.695700758887578*^9}, 
   3.6957008918720627`*^9, {3.695701048390256*^9, 3.6957010701356993`*^9}, {
   3.69570110397906*^9, 3.6957011096394873`*^9}, {3.6957011448678102`*^9, 
   3.6957011450578413`*^9}, {3.695701257669434*^9, 3.695701313716563*^9}, {
   3.695701414043988*^9, 3.695701416201571*^9}, {3.695701481036119*^9, 
   3.6957014871396523`*^9}, {3.695701647539864*^9, 3.6957016478024197`*^9}, 
   3.695702140740499*^9, {3.695702336028249*^9, 3.695702336652255*^9}, 
   3.695702399894343*^9, {3.6957026081087027`*^9, 3.695702660775633*^9}, {
   3.695702724873065*^9, 3.69570274117041*^9}, {3.695702783333552*^9, 
   3.695702813165053*^9}, {3.695702893899559*^9, 3.695702900849497*^9}, {
   3.695702933893079*^9, 3.695702943435268*^9}, {3.695702981863635*^9, 
   3.6957030729039593`*^9}, {3.6957031144121723`*^9, 3.695703114631094*^9}, {
   3.695727134346449*^9, 3.695727183353898*^9}, {3.6957272566816473`*^9, 
   3.6957273034908133`*^9}, {3.6957276121203814`*^9, 3.695727615363844*^9}, {
   3.695727768825706*^9, 3.69572781662407*^9}, {3.695728384467928*^9, 
   3.695728385596464*^9}, 3.695728417764214*^9, {3.6957285781284637`*^9, 
   3.6957285787388678`*^9}, {3.695728753750229*^9, 3.6957287594928017`*^9}, {
   3.695728875336128*^9, 3.6957288831440487`*^9}, {3.695728949176746*^9, 
   3.6957289585369873`*^9}, {3.695729025579973*^9, 3.695729031457849*^9}, {
   3.695729063910069*^9, 3.695729068916049*^9}, 3.695729155874537*^9, {
   3.6957292896457567`*^9, 3.6957292917313557`*^9}, {3.6957293219528923`*^9, 
   3.695729324029669*^9}, 3.701622051802857*^9, {3.701622358927799*^9, 
   3.701622510324482*^9}, {3.701622603033215*^9, 3.701622782995887*^9}, {
   3.70162291155221*^9, 3.701622930292186*^9}, {3.701623270576461*^9, 
   3.7016233659006977`*^9}, {3.7016235228587933`*^9, 3.7016235744784737`*^9}, 
   3.7016236075164747`*^9, {3.701623713975377*^9, 3.701623715904273*^9}, {
   3.701623781709463*^9, 3.701623803807426*^9}, {3.701625667776462*^9, 
   3.701625710495141*^9}, {3.7016261396122627`*^9, 3.701626159550157*^9}, 
   3.701628442922727*^9, 3.70162853036187*^9, {3.7016292347794027`*^9, 
   3.701629513692987*^9}, {3.701629696374428*^9, 3.701629697987493*^9}, {
   3.701629834685322*^9, 3.70162985904431*^9}, {3.701629989289727*^9, 
   3.701630011193266*^9}, {3.7016300472308702`*^9, 3.7016300676831512`*^9}, {
   3.7016301146130753`*^9, 3.701630204883151*^9}, {3.701630249359593*^9, 
   3.70163028165084*^9}, {3.701630417119028*^9, 3.701630602490706*^9}, {
   3.7016306626475277`*^9, 3.7016308718058558`*^9}, 3.701630921167513*^9, 
   3.701630958792674*^9, {3.701631044471355*^9, 3.701631133966515*^9}, {
   3.70163119159352*^9, 3.701631192179913*^9}, {3.701631231138753*^9, 
   3.701631253107134*^9}, {3.701631289633829*^9, 3.701631292822938*^9}, {
   3.70163132293215*^9, 3.701631324201703*^9}, {3.701631368180533*^9, 
   3.701631550224154*^9}, {3.701631596045938*^9, 3.7016315963987827`*^9}, {
   3.701631641017632*^9, 3.701631659898036*^9}, {3.7016318242634783`*^9, 
   3.701631961793498*^9}, {3.701632018794057*^9, 3.701632069939075*^9}, {
   3.70163224606256*^9, 3.701632277582417*^9}, {3.701632360445959*^9, 
   3.701632388698868*^9}, {3.7016324300580807`*^9, 3.701632450612406*^9}, {
   3.7016324943703327`*^9, 3.701632565908565*^9}, 3.701632830493144*^9, {
   3.701632889950131*^9, 3.701632919649426*^9}, {3.701632985725484*^9, 
   3.701633008122641*^9}, {3.701633086641267*^9, 3.701633096983684*^9}, {
   3.701633186340723*^9, 3.701633210005045*^9}, {3.7016332530407248`*^9, 
   3.70163326743159*^9}, {3.701633318698876*^9, 3.701633544551071*^9}, {
   3.701633579700658*^9, 3.701633644916191*^9}, {3.701633678350339*^9, 
   3.701634060654797*^9}, {3.701634099739345*^9, 3.7016341447476*^9}, {
   3.701634247269351*^9, 3.701634389784688*^9}, {3.7016344259673977`*^9, 
   3.701634434722928*^9}, {3.701634474827154*^9, 3.701634485893292*^9}, {
   3.701634558235238*^9, 3.701634648478245*^9}, {3.7016347974994392`*^9, 
   3.70163482705684*^9}, {3.701635319243465*^9, 3.7016353483573933`*^9}, {
   3.701635397923039*^9, 3.701635464656693*^9}, {3.701635542335372*^9, 
   3.701635599626309*^9}, {3.7016356875171337`*^9, 3.701635687997017*^9}, {
   3.701635744532627*^9, 3.701635747133205*^9}, {3.7016358848706284`*^9, 
   3.7016359111999474`*^9}, {3.701636035238124*^9, 3.701636038912578*^9}, {
   3.701636091816286*^9, 3.701636113299172*^9}, {3.701636396094829*^9, 
   3.701636405337887*^9}, {3.701636469075354*^9, 3.7016364787593393`*^9}, {
   3.701636837839485*^9, 3.701636867675003*^9}, {3.7016369547883472`*^9, 
   3.701637017454657*^9}, {3.701637076527495*^9, 3.701637092582127*^9}, {
   3.701637164243052*^9, 3.7016371797856007`*^9}, 3.701637244713079*^9, {
   3.701637293942173*^9, 3.701637297640402*^9}, {3.701637501452693*^9, 
   3.701637540994927*^9}, {3.7016376854851227`*^9, 3.701637700194195*^9}, 
   3.701637734504342*^9, {3.7016377660598*^9, 3.701637766429948*^9}, {
   3.7016379142138433`*^9, 3.701637990367529*^9}, {3.701638051065907*^9, 
   3.701638098480389*^9}, 3.7016381389851027`*^9, {3.701638320322727*^9, 
   3.701638353081571*^9}, {3.701638447396517*^9, 3.701638525174213*^9}, {
   3.701638580182357*^9, 3.701638603695876*^9}, {3.7016386482930937`*^9, 
   3.7016386513733673`*^9}, 3.701638707587962*^9, {3.701638761757633*^9, 
   3.701638800638187*^9}, {3.701639331723557*^9, 3.701639356521208*^9}, 
   3.70164099049853*^9, {3.701641080395234*^9, 3.7016410919018993`*^9}, {
   3.7016423554939737`*^9, 3.7016423559954157`*^9}, {3.7030246721365957`*^9, 
   3.703024763402748*^9}, {3.703024805653809*^9, 3.703024985586863*^9}, {
   3.703025019161644*^9, 3.7030251899298353`*^9}, {3.703025223019319*^9, 
   3.7030252244050827`*^9}, {3.703025691235117*^9, 3.703025693259348*^9}, 
   3.703025764801528*^9, {3.703025874840461*^9, 3.703025904895837*^9}, {
   3.70302612680272*^9, 3.703026150601853*^9}, {3.703026190155209*^9, 
   3.7030261974665403`*^9}, {3.703026272327881*^9, 3.703026434779841*^9}, {
   3.703026560427484*^9, 3.703026583880857*^9}, {3.703026687606843*^9, 
   3.703026731643218*^9}, {3.703026784150725*^9, 3.70302680018918*^9}, 
   3.703026971087738*^9, {3.703027026131425*^9, 3.703027063955084*^9}, {
   3.703027209395842*^9, 3.703027240552249*^9}, {3.703027426938039*^9, 
   3.703027501956758*^9}, {3.7030277789804277`*^9, 3.703027809487584*^9}, {
   3.703028137056849*^9, 3.703028139487507*^9}, 3.703031628774702*^9, {
   3.70337706087949*^9, 3.703377161088091*^9}, {3.703377245966461*^9, 
   3.703377259578855*^9}, {3.703604534145193*^9, 3.703604739196944*^9}, 
   3.703604799140334*^9, {3.7036048761706247`*^9, 3.70360489292696*^9}, {
   3.703605023936388*^9, 3.7036050447860947`*^9}, 3.70360508340939*^9, {
   3.7036051576390142`*^9, 3.703605176007123*^9}, 3.703605236367323*^9, {
   3.703605459941523*^9, 3.703605537089568*^9}, {3.703606225252296*^9, 
   3.703606271815935*^9}, {3.7036104631708317`*^9, 3.7036105456621637`*^9}, {
   3.703610579945662*^9, 3.703610595625889*^9}, {3.703610630930423*^9, 
   3.703610637690324*^9}, {3.703610693072962*^9, 3.703610718869947*^9}, 
   3.703610770452903*^9, 3.703610886281095*^9, {3.703611172246809*^9, 
   3.703611183940341*^9}, {3.7036112772142572`*^9, 3.7036114458121567`*^9}, {
   3.703611475917807*^9, 3.703611615536949*^9}, {3.703611670348978*^9, 
   3.703611826262199*^9}, {3.703611861751831*^9, 3.703611993446333*^9}, {
   3.703612077875527*^9, 3.703612112619858*^9}, {3.703612149026486*^9, 
   3.703612182817762*^9}, {3.70361221812672*^9, 3.70361252610233*^9}, {
   3.703612590063862*^9, 3.7036125945899076`*^9}, {3.7036126290777884`*^9, 
   3.703612629351858*^9}, {3.703612712671495*^9, 3.703612718940592*^9}, {
   3.703612797665873*^9, 3.70361279906218*^9}, {3.703612842142962*^9, 
   3.703612843907383*^9}, {3.7036129217112093`*^9, 3.7036129236238947`*^9}, {
   3.7036130069933558`*^9, 3.703613021297665*^9}, {3.703613099971203*^9, 
   3.703613128266305*^9}, {3.703613219913216*^9, 3.70361322908002*^9}, {
   3.703613300964287*^9, 3.70361331512922*^9}, 3.703613381621737*^9, {
   3.703613516349656*^9, 3.703613550750681*^9}, {3.7036136450090437`*^9, 
   3.703613646274514*^9}, {3.703613698182526*^9, 3.70361370019751*^9}, {
   3.7036138502177153`*^9, 3.703613874634104*^9}, {3.7036139172075863`*^9, 
   3.703613922011331*^9}, {3.703613956527318*^9, 3.703613998760551*^9}, {
   3.703614058918104*^9, 3.7036140635566187`*^9}, {3.703614398975545*^9, 
   3.7036144111446743`*^9}, {3.703614480962388*^9, 3.7036144823658953`*^9}, {
   3.703614518613593*^9, 3.7036145187830887`*^9}, {3.703615123486929*^9, 
   3.703615231451703*^9}, {3.7036153780373507`*^9, 3.703615379510051*^9}, 
   3.7036158618750477`*^9, {3.703615984105853*^9, 3.70361598749055*^9}, {
   3.70361679689848*^9, 3.703616801705*^9}, {3.703616852424429*^9, 
   3.703616879780031*^9}, {3.7036171483613377`*^9, 3.703617163835437*^9}, {
   3.703617478656497*^9, 3.703617519474847*^9}, {3.703617551609613*^9, 
   3.70361757645269*^9}, {3.703617625227675*^9, 3.7036176614522943`*^9}, {
   3.703617704805633*^9, 3.703617712628286*^9}, {3.7036179642299767`*^9, 
   3.703617982269909*^9}, {3.7036180227901154`*^9, 3.7036180335728617`*^9}, {
   3.703618094847167*^9, 3.703618118467678*^9}, {3.7036181519876842`*^9, 
   3.7036182200133047`*^9}, {3.703618258745352*^9, 3.703618275264114*^9}, 
   3.703618324728754*^9, {3.703618359298267*^9, 3.703618365979719*^9}, {
   3.703618438691696*^9, 3.703618479937006*^9}, {3.7036185413130627`*^9, 
   3.70361854240524*^9}, {3.703618617321577*^9, 3.703618628139361*^9}, {
   3.7036189141254387`*^9, 3.7036189156336117`*^9}, 3.703619049826025*^9, {
   3.7036190861143417`*^9, 3.703619112609674*^9}, {3.703619351602682*^9, 
   3.7036193607493343`*^9}, {3.7036193911185637`*^9, 3.703619396413344*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`Ex$$ = 1, $CellContext`Ey$$ = 
    1, $CellContext`n1$$ = 1.5, $CellContext`n2$$ = 1.5, $CellContext`n3$$ = 
    1.5, $CellContext`nrays1$$ = 2, $CellContext`nrays2$$ = 
    10, $CellContext`Rbundle$$ = 
    0.29000000000000004`, $CellContext`\[Delta]$$ = Rational[1, 2] 
    Pi, $CellContext`\[Theta]0$$ = Rational[1, 2] Pi + 
    ArcTan[2^Rational[-1, 2]], $CellContext`\[Theta]1$$ = 
    0, $CellContext`\[Phi]0$$ = Rational[3, 2] Pi, $CellContext`\[Phi]1$$ = 
    Rational[1, 4] Pi, $CellContext`\[Psi]1$$ = 0, Typeset`show$$ = True, 
    Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`nrays1$$], 8}, 1, 10, 1}, {{
       Hold[$CellContext`nrays2$$], 8}, 1, 10, 1}, {{
       Hold[$CellContext`Rbundle$$], 0.1}, 0.1, 1}, {{
       Hold[$CellContext`Ex$$], 1}, 0, 2}, {{
       Hold[$CellContext`Ey$$], 1}, 0, 2}, {{
       Hold[$CellContext`\[Delta]$$], Rational[1, 2] Pi}, 0, 2 Pi}, {{
       Hold[$CellContext`\[Theta]0$$], Rational[1, 2] Pi + 
       ArcTan[2^Rational[-1, 2]]}, 0, Pi}, {{
       Hold[$CellContext`\[Phi]0$$], Rational[3, 2] Pi}, 0, 2 Pi}, {{
       Hold[$CellContext`\[Theta]1$$], 0}, 0, Pi}, {{
       Hold[$CellContext`\[Phi]1$$], Rational[1, 4] Pi}, 0, 2 Pi}, {{
       Hold[$CellContext`\[Psi]1$$], 0}, 0, 2 Pi}, {{
       Hold[$CellContext`n1$$], 1.5}, 0, 2}, {{
       Hold[$CellContext`n2$$], 1.5}, 0, 2}, {{
       Hold[$CellContext`n3$$], 1.5}, 0, 2}}, Typeset`size$$ = {
    605., {343., 350.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = True, $CellContext`nrays1$3174048$$ = 
    0, $CellContext`nrays2$3174049$$ = 0, $CellContext`Rbundle$3174050$$ = 
    0, $CellContext`Ex$3174051$$ = 0, $CellContext`Ey$3174052$$ = 
    0, $CellContext`\[Delta]$3174053$$ = 0, $CellContext`\[Theta]0$3174054$$ =
     0, $CellContext`\[Phi]0$3174055$$ = 0, $CellContext`\[Theta]1$3174056$$ =
     0, $CellContext`\[Phi]1$3174057$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`Ex$$ = 1, $CellContext`Ey$$ = 
        1, $CellContext`n1$$ = 1.5, $CellContext`n2$$ = 
        1.5, $CellContext`n3$$ = 1.5, $CellContext`nrays1$$ = 
        8, $CellContext`nrays2$$ = 8, $CellContext`Rbundle$$ = 
        0.1, $CellContext`\[Delta]$$ = 
        Rational[1, 2] Pi, $CellContext`\[Theta]0$$ = 
        Rational[1, 2] Pi + 
         ArcTan[2^Rational[-1, 2]], $CellContext`\[Theta]1$$ = 
        0, $CellContext`\[Phi]0$$ = Rational[3, 2] Pi, $CellContext`\[Phi]1$$ = 
        Rational[1, 4] Pi, $CellContext`\[Psi]1$$ = 0}, "ControllerVariables" :> {
        Hold[$CellContext`nrays1$$, $CellContext`nrays1$3174048$$, 0], 
        Hold[$CellContext`nrays2$$, $CellContext`nrays2$3174049$$, 0], 
        Hold[$CellContext`Rbundle$$, $CellContext`Rbundle$3174050$$, 0], 
        Hold[$CellContext`Ex$$, $CellContext`Ex$3174051$$, 0], 
        Hold[$CellContext`Ey$$, $CellContext`Ey$3174052$$, 0], 
        Hold[$CellContext`\[Delta]$$, $CellContext`\[Delta]$3174053$$, 0], 
        Hold[$CellContext`\[Theta]0$$, $CellContext`\[Theta]0$3174054$$, 0], 
        Hold[$CellContext`\[Phi]0$$, $CellContext`\[Phi]0$3174055$$, 0], 
        Hold[$CellContext`\[Theta]1$$, $CellContext`\[Theta]1$3174056$$, 0], 
        Hold[$CellContext`\[Phi]1$$, $CellContext`\[Phi]1$3174057$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> Quiet[
        Module[{}, $CellContext`Efield = Dot[
            $CellContext`SphericalBase[$CellContext`\[Theta]0$$, \
$CellContext`\[Phi]0$$, 0], {$CellContext`Ex$$, $CellContext`Ey$$ 
             Exp[I $CellContext`\[Delta]$$], 
             
             0}]; $CellContext`S0 = $CellContext`SphericalBase[$CellContext`\
\[Theta]1$$, $CellContext`\[Phi]1$$, $CellContext`\[Psi]1$$]; $CellContext`M1 = 
          Dot[$CellContext`S0, {{0, 0, 1}, {1, 0, 0}, {0, 1, 
            0}}]; $CellContext`M2 = 
          Dot[$CellContext`S0, {{0, 1, 0}, {0, 0, 1}, {1, 0, 
            0}}]; $CellContext`M3 = 
          Dot[$CellContext`S0, {{1, 0, 0}, {0, 1, 0}, {0, 0, 
            1}}]; {$CellContext`u1, $CellContext`v1, $CellContext`w1} = 
          Transpose[$CellContext`M1]; {$CellContext`u2, $CellContext`v2, \
$CellContext`w2} = 
          Transpose[$CellContext`M2]; {$CellContext`u3, $CellContext`v3, \
$CellContext`w3} = Transpose[$CellContext`M3]; $CellContext`S = 
          Join[$CellContext`B, {$CellContext`M1, $CellContext`M2, \
$CellContext`M3}]; $CellContext`r1 = 
          Dot[$CellContext`S0, {-1, 0, 0}]; $CellContext`r2 = 
          Dot[$CellContext`S0, {0, -1, 0}]; $CellContext`r3 = 
          Dot[$CellContext`S0, {0, 
            0, -1}]; {$CellContext`b1, $CellContext`b2, $CellContext`b3} = 
          2 IdentityMatrix[
            3]; $CellContext`centers = {-$CellContext`b3, -$CellContext`b2, \
-$CellContext`b1, $CellContext`b1, $CellContext`b2, $CellContext`b3, \
$CellContext`r1, $CellContext`r2, $CellContext`r3}; $CellContext`n0 = 
          2; $CellContext`refidx = {$CellContext`n0, $CellContext`n0, \
$CellContext`n0, $CellContext`n0, $CellContext`n0, $CellContext`n0, \
$CellContext`n1$$, $CellContext`n2$$, $CellContext`n3$$}; \
$CellContext`x0Bundle = {0, 
            Sqrt[2], 1}; $CellContext`x0 = Flatten[
            Table[$CellContext`x0Bundle + Dot[
               $CellContext`SphericalBase[$CellContext`\[Theta]0$$, \
$CellContext`\[Phi]0$$, 0], 
               
               Apply[{# Sin[#2], # Cos[#2], 
                 0}& , {$CellContext`Rbundle$$ (($CellContext`i + 
                   Boole[$CellContext`nrays1$$ > 1])/$CellContext`nrays1$$), 
                 2 Pi ($CellContext`j/$CellContext`nrays2$$)}]], \
{$CellContext`i, 0, $CellContext`nrays1$$ - 1}, {$CellContext`j, 
              0, $CellContext`nrays2$$ - 1}], 1]; $CellContext`path = 
          Map[{#}& , $CellContext`x0]; $CellContext`k0 = ConstantArray[
            $CellContext`SphericalUnit[$CellContext`\[Theta]0$$, \
$CellContext`\[Phi]0$$], 
            Length[$CellContext`x0]]; $CellContext`P = ConstantArray[
            IdentityMatrix[3], 
            
            Length[$CellContext`x0]]; $CellContext`Pobs = {{}, {}, {}, {}, \
{}, {}}; $CellContext`m = 1; While[$CellContext`m <= Min[1000, 
             Length[$CellContext`x0]], $CellContext`ki = 
            Part[$CellContext`k0, $CellContext`m]; $CellContext`xi = 
            Part[$CellContext`x0, $CellContext`m]; $CellContext`j = 
            7; $CellContext`its = 0; While[
             
             And[$CellContext`its < 100, $CellContext`j > 6], $CellContext`L = 
              MapThread[
               If[Dot[$CellContext`ki, #] == 0, -100000, 
                 Dot[#2 - $CellContext`xi, #]/Dot[$CellContext`ki, #]]& , {
                 Part[$CellContext`S, 
                  Span[1, All], 
                  Span[1, All], 3], $CellContext`centers}]; $CellContext`d = 
              Map[$CellContext`xi + # $CellContext`ki& , $CellContext`L] - \
$CellContext`centers; $CellContext`q = MapThread[Norm[
                  Dot[
                   Inverse[#], #2], Infinity] < 
                1& , {$CellContext`S, $CellContext`d}]; $CellContext`LL = 
              Pick[$CellContext`L, $CellContext`q, True]; $CellContext`j = 
              Position[$CellContext`L, 
                Min[
                 Select[$CellContext`LL, # > $CellContext`EPS& ]]]; 
             If[Length[$CellContext`j] == 0, $CellContext`its = 100; 
               Null, $CellContext`j = 
                Part[$CellContext`j, 1, 1]; $CellContext`xi = $CellContext`xi + 
                 Part[$CellContext`L, $CellContext`j] $CellContext`ki; 
               Part[$CellContext`path, $CellContext`m] = Append[
                  Part[$CellContext`path, $CellContext`m], $CellContext`xi]; 
               If[$CellContext`j > 
                 6, {$CellContext`Rays, $CellContext`P1, $CellContext`P2} = \
$CellContext`ReflectRefract[
                    Part[$CellContext`S, $CellContext`j, 
                    Span[1, All], 3], $CellContext`ki, 
                    Part[$CellContext`refidx, $CellContext`j]]; 
                 Part[$CellContext`P, $CellContext`m] = Dot[$CellContext`P1, 
                    Part[$CellContext`P, $CellContext`m]]; $CellContext`ki = 
                  Part[$CellContext`Rays, 
                    Span[1, All], 2]; $CellContext`P = 
                  Append[$CellContext`P, 
                    Dot[$CellContext`P2, 
                    Part[$CellContext`P, $CellContext`m]]]; $CellContext`k0 = 
                  Append[$CellContext`k0, 
                    Part[$CellContext`Rays, 
                    Span[1, All], 3]]; $CellContext`x0 = 
                  Append[$CellContext`x0, $CellContext`xi]; $CellContext`path = 
                  Append[$CellContext`path, {$CellContext`xi}]; Null]; 
               Null]; $CellContext`its = $CellContext`its + 1; Null]; 
           Part[$CellContext`Pobs, $CellContext`j] = Append[
              Part[$CellContext`Pobs, $CellContext`j], 
              $CellContext`Stokes[
               Part[$CellContext`P, $CellContext`m], $CellContext`Efield, 
               Dot[{{1, 0, 0}, {0, 1, 0}}, 
                Inverse[
                 
                 Part[$CellContext`S, $CellContext`j]], $CellContext`xi], \
$CellContext`Rbundle$$/(4 
               Sqrt[$CellContext`nrays1$$ $CellContext`nrays2$$])]]; \
$CellContext`m = $CellContext`m + 1; Null]; Show[
           Join[
            Map[Graphics3D[{Red, 
               Arrow[#]}]& , $CellContext`path], {
             Graphics3D[{Black, 
               Arrow[{$CellContext`r1, $CellContext`r1 + $CellContext`w1}]}], 
             
             Graphics3D[{Black, 
               Arrow[{$CellContext`r2, $CellContext`r2 + $CellContext`w2}]}], 
             
             Graphics3D[{Black, 
               Arrow[{$CellContext`r3, $CellContext`r3 + $CellContext`w3}]}], 
             
             
             ParametricPlot3D[$CellContext`r1 + $CellContext`\[Lambda] \
$CellContext`u1 + $CellContext`\[Mu] $CellContext`v1, \
{$CellContext`\[Lambda], -1, 1}, {$CellContext`\[Mu], -1, 1}, Mesh -> None, 
              PlotStyle -> Directive[Red, 
                Opacity[0.5]]], 
             
             ParametricPlot3D[$CellContext`r2 + $CellContext`\[Lambda] \
$CellContext`u2 + $CellContext`\[Mu] $CellContext`v2, \
{$CellContext`\[Lambda], -1, 1}, {$CellContext`\[Mu], -1, 1}, Mesh -> None, 
              PlotStyle -> Directive[Green, 
                Opacity[0.5]]], 
             
             ParametricPlot3D[$CellContext`r3 + $CellContext`\[Lambda] \
$CellContext`u3 + $CellContext`\[Mu] $CellContext`v3, \
{$CellContext`\[Lambda], -1, 1}, {$CellContext`\[Mu], -1, 1}, Mesh -> None, 
              PlotStyle -> Directive[Blue, 
                Opacity[0.5]]]}], PlotRange -> {{-2, 2}, {-2, 2}, {-2, 2}}, 
           Axes -> True, AxesLabel -> {"x", "y", "z"}]]], 
      "Specifications" :> {{{$CellContext`nrays1$$, 8}, 1, 10, 
         1}, {{$CellContext`nrays2$$, 8}, 1, 10, 
         1}, {{$CellContext`Rbundle$$, 0.1}, 0.1, 1}, {{$CellContext`Ex$$, 1},
          0, 2}, {{$CellContext`Ey$$, 1}, 0, 
         2}, {{$CellContext`\[Delta]$$, Rational[1, 2] Pi}, 0, 2 
         Pi}, {{$CellContext`\[Theta]0$$, Rational[1, 2] Pi + 
          ArcTan[2^Rational[-1, 2]]}, 0, 
         Pi}, {{$CellContext`\[Phi]0$$, Rational[3, 2] Pi}, 0, 2 
         Pi}, {{$CellContext`\[Theta]1$$, 0}, 0, 
         Pi}, {{$CellContext`\[Phi]1$$, Rational[1, 4] Pi}, 0, 2 
         Pi}, {{$CellContext`\[Psi]1$$, 0}, 0, 2 
         Pi}, {{$CellContext`n1$$, 1.5}, 0, 2}, {{$CellContext`n2$$, 1.5}, 0, 
         2}, {{$CellContext`n3$$, 1.5}, 0, 2}}, "Options" :> {}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{913., {374., 381.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.703604800157901*^9, 3.703604893654319*^9, 3.7036050452191973`*^9, 
   3.70360508419485*^9, {3.703605163108934*^9, 3.703605176998804*^9}, 
   3.70360523846513*^9, {3.7036054430921373`*^9, 3.7036055374711933`*^9}, 
   3.703606272684499*^9, 3.703608438395503*^9, 3.703610548846233*^9, {
   3.703610588177211*^9, 3.7036105972396708`*^9}, 3.703610638214055*^9, 
   3.7036107193401117`*^9, {3.7036107734861526`*^9, 3.703610775939282*^9}, 
   3.703611184840114*^9, 3.70361161789002*^9, 3.703611672394679*^9, 
   3.703612555355774*^9, 3.7036125982517767`*^9, 3.70361264856144*^9, 
   3.703612799687871*^9, 3.703612844459736*^9, 3.703612924713122*^9, 
   3.7036130220836267`*^9, {3.703613107680462*^9, 3.703613130137885*^9}, 
   3.703613316876955*^9, {3.703613388624029*^9, 3.7036134030373898`*^9}, 
   3.70361355151962*^9, 3.7036136469704733`*^9, 3.70361370114289*^9, 
   3.703613875278799*^9, 3.703613922340341*^9, 3.7036140045635357`*^9, 
   3.7036140652382927`*^9, 3.7036144132020082`*^9, 3.703614484208042*^9, 
   3.703614521237413*^9, 3.703614610615703*^9, 3.703614876469988*^9, {
   3.7036151386209517`*^9, 3.703615233804061*^9}, 3.703615381876794*^9, 
   3.703615515803611*^9, 3.703615764868643*^9, 3.7036159898425198`*^9, 
   3.70361680325249*^9, {3.7036168553761063`*^9, 3.7036168823027363`*^9}, 
   3.703617072856814*^9, 3.703617165882514*^9, 3.703617521295405*^9, 
   3.7036175809682007`*^9, 3.70361766312717*^9, 3.7036177142813663`*^9, 
   3.703617983634612*^9, 3.703618036202454*^9, {3.7036181068666067`*^9, 
   3.703618120201646*^9}, 3.703618158826747*^9, {3.7036181890779953`*^9, 
   3.703618220827976*^9}, 3.703618262302709*^9, {3.7036183254763947`*^9, 
   3.703618334619823*^9}, 3.703618368264551*^9, {3.703618441875948*^9, 
   3.703618483295721*^9}, 3.7036185440487013`*^9, 3.703618630897903*^9, 
   3.7036189192063923`*^9, 3.7036190512787867`*^9, {3.703619086674329*^9, 
   3.703619114022109*^9}, 3.703619363085593*^9, {3.703619398864732*^9, 
   3.703619402993132*^9}, 3.703623464767919*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Show", "[", "#", "]"}], "&"}], "/@", "Pobs"}]], "Input",
 CellChangeTimes->{{3.703613418162591*^9, 3.703613419145822*^9}, {
   3.703613472106472*^9, 3.7036134845161858`*^9}, {3.703616639771782*^9, 
   3.703616658211759*^9}, {3.7036185039532557`*^9, 3.703618504166863*^9}, {
   3.703618873777663*^9, 3.7036188859101543`*^9}, {3.703618934599577*^9, 
   3.703618952827594*^9}, 3.703619075153429*^9}],

Cell[BoxData[
 TemplateBox[{
  "Show","shx","\"No graphical objects to show.\"",2,108,52,
   31210427158329762308,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.703616091850768*^9, 3.703616493924968*^9, {3.703616532797155*^9, 
   3.7036166261357317`*^9}, 3.7036166589599047`*^9, {3.703616708667366*^9, 
   3.70361672065368*^9}, {3.703616758506772*^9, 3.7036167797550383`*^9}, {
   3.70361681170615*^9, 3.703616825305538*^9}, {3.7036168609194736`*^9, 
   3.703616886770808*^9}, {3.703616926380649*^9, 3.703616937582299*^9}, 
   3.703617087383604*^9, 3.703617128250886*^9, 3.7036171698324013`*^9, {
   3.703617216739546*^9, 3.7036172565550537`*^9}, 3.7036175858980417`*^9, {
   3.703617668476403*^9, 3.703617690749599*^9}, {3.703617720831711*^9, 
   3.703617774676917*^9}, {3.7036179879332113`*^9, 3.7036180063221703`*^9}, 
   3.703618124666595*^9, {3.703618224902891*^9, 3.7036182341794453`*^9}, 
   3.703618265168347*^9, {3.7036183289807*^9, 3.703618352505383*^9}, {
   3.703618486879045*^9, 3.703618599092411*^9}, {3.703618635631548*^9, 
   3.7036186574456167`*^9}, 3.7036188867318907`*^9, {3.703618923023972*^9, 
   3.703619033409177*^9}, {3.7036190643971167`*^9, 3.703619295130624*^9}, 
   3.703619367685039*^9, {3.703619405013813*^9, 3.703619431432023*^9}, {
   3.703623468611142*^9, 3.7036234817539577`*^9}, {3.7036235959542847`*^9, 
   3.703623608878517*^9}, 3.703623659664138*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   GraphicsBox[{
     GeometricTransformationBox[
      CircleBox[{-0.3244428422615249, -0.6346067811865473}, \
{0.03242205403870287, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.0586537320921837, -0.9577392641820788}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.022403732092183694, -0.9121219534338543}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.022403732092183694, -0.9121219534338543}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.0586537320921837, -0.9577392641820788}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.3244428422615249, -0.6346067811865473}, \
{0.03242205403870287, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.05865373209218396, -0.3088535796590289}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.02240373209218404, -0.26323626891080415}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.02240373209218404, -0.26323626891080415}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.05865373209218396, -0.3088535796590289}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.324442842261525, -0.5621067811865473}, \
{0.03242205403870287, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.1173074641843674, -0.8839289049160857}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.04480746418436739, -0.7926942834196361}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.04480746418436739, -0.7926942834196361}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.1173074641843674, -0.8839289049160857}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.324442842261525, -0.5621067811865473}, \
{0.03242205403870287, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.11730746418436745, -0.23504322039303566}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.04480746418436739, -0.1438085988965861}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.04480746418436739, -0.1438085988965861}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.11730746418436745, -0.23504322039303566}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}]}], 
   ",", 
   GraphicsBox[{
     GeometricTransformationBox[
      CircleBox[{-0.6112610228110774, 0.20804637139052476}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.3329151774387583, 0.18906368803881984}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.2911501834292594, 0.13936637782637967}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.02165466877904798, -0.8723517358019389}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.2911501834292594, -0.13936637782637967}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.02165466877904798, 0.8723517358019389}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.3329151774387583, -0.18906368803881984}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.6112610228110774, -0.20804637139052476}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.5627012114436429, -0.18906368803881993}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.5399535859140149, -0.1393663778263798}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.8094491005642268, 0.87235173580194}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.5399535859140149, 0.1393663778263798}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.8094491005642268, -0.87235173580194}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.5627012114436429, 0.18906368803881993}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.5922436543312063, 0.3074409918154051}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.29610874616846533, 0.26947562511199524}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.21257875814946697, 0.17008100468711496}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.10549837121863836, -0.955149351541601}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.21257875814946697, -0.17008100468711496}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.10549837121863836, 0.955149351541601}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.29610874616846533, -0.26947562511199524}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.5922436543312063, -0.3074409918154051}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.49512403159633755, -0.2694756251119953}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.4496287805370813, -0.17008100468711496}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.7677059099051866, 0.955149351541601}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.4496287805370813, 0.17008100468711496}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.7677059099051866, -0.955149351541601}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.49512403159633755, 0.2694756251119953}, \
{0.03238861534077897, 0.00003437033296798229}], {{{1, 0}, {0, 1}}, Center}]}],
    ",", 
   GraphicsBox[{
     GeometricTransformationBox[
      CircleBox[{-0.978672442484154, -0.036184381090423934}, \
{0.032422938393715836, 4.728003112135388*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.997655125835859, 0.012375430277010546}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.9976551258358588, -0.9079918191594117}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.8792778220592737, -0.017167012610552812}, \
{0.032422938393715836, 4.728003112135388*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.9172431887626837, 0.07995261012431593}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.9172431887626835, -0.8711853878891187}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}]}], 
   ",", 
   GraphicsBox[{
     GeometricTransformationBox[
      CircleBox[{0.012375430277010546, -0.997655125835859}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.036184381090423934, -0.978672442484154}, \
{0.032422938393715836, 4.728003112135388*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.9079918191594117, -0.9976551258358588}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.07995261012431593, -0.9172431887626837}, \
{0.03242293839371583, 4.728003112315372*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.017167012610552812, -0.8792778220592737}, \
{0.032422938393715836, 4.728003112135388*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.8711853878891187, -0.9172431887626835}, \
{0.032422054038702866, 9.31635044084531*^-7}], {{{1, 0}, {0, 1}}, Center}]}], 
   ",", 
   GraphicsBox[{
     GeometricTransformationBox[
      CircleBox[{-0.07250000000000018, 0.7071067811865477}, \
{0.03242289819878704, 8.747495992565325*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.058653732092183754, 0.7592985867453471}, \
{0.03242289819878703, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.02240373209218373, 0.7915548965149103}, \
{0.03242289819878703, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.02240373209218373, 0.7915548965149103}, \
{0.03242289819878703, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.058653732092183754, 0.7592985867453471}, \
{0.03242289819878703, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.07250000000000018, 0.7071067811865477}, \
{0.03242289819878704, 8.747495992565325*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.05865373209218396, 0.6549149756277481}, \
{0.032422898198787034, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.02240373209218404, 0.6226586658581845}, \
{0.032422898198787034, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.02240373209218404, 0.6226586658581845}, \
{0.032422898198787034, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.05865373209218396, 0.6549149756277481}, \
{0.032422898198787034, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.14500000000000007, 0.7071067811865477}, \
{0.03242289819878704, 8.747495992565325*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.11730746418436731, 0.8114903923041463}, \
{0.03242289819878703, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.04480746418436739, 0.8760030118432736}, \
{0.03242289819878703, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.04480746418436739, 0.8760030118432736}, \
{0.03242289819878703, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.11730746418436731, 0.8114903923041463}, \
{0.03242289819878703, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.14500000000000007, 0.7071067811865477}, \
{0.03242289819878704, 8.747495992565325*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.11730746418436745, 0.602723170068949}, \
{0.032422898198787034, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{0.04480746418436739, 0.5382105505298216}, \
{0.032422898198787034, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.04480746418436739, 0.5382105505298216}, \
{0.032422898198787034, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}], 
     GeometricTransformationBox[
      CircleBox[{-0.11730746418436745, 0.602723170068949}, \
{0.032422898198787034, 8.747495992745309*^-8}], {{{1, 0}, {0, 1}}, Center}]}],
    ",", 
   RowBox[{"Show", "[", 
    RowBox[{"{", "}"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.703613419673558*^9, 3.703613446435647*^9}, 
   3.70361348559077*^9, {3.703613557602558*^9, 3.703613575115843*^9}, 
   3.70361361783523*^9, {3.7036136559506893`*^9, 3.70361366894943*^9}, {
   3.7036137111217003`*^9, 3.703613772180777*^9}, {3.703614010298492*^9, 
   3.703614029211645*^9}, 3.703614075372396*^9, {3.7036141769200706`*^9, 
   3.703614278593192*^9}, 3.703614340028298*^9, 3.703614446859198*^9, {
   3.703614648935707*^9, 3.703614673851244*^9}, 3.703614716960047*^9, 
   3.703614748422123*^9, {3.703614802074828*^9, 3.7036148813061867`*^9}, 
   3.703615398184705*^9, {3.703615441204493*^9, 3.703615473243207*^9}, {
   3.7036155720825567`*^9, 3.703615589376545*^9}, 3.703615676274743*^9, {
   3.7036157125549297`*^9, 3.7036157327213507`*^9}, {3.703615768418027*^9, 
   3.703615794828546*^9}, 3.703615873664534*^9, 3.703616026975793*^9, 
   3.7036160918579073`*^9, 3.703616493935211*^9, {3.703616532811606*^9, 
   3.703616626144793*^9}, 3.703616658982541*^9, {3.7036167086817513`*^9, 
   3.703616720674808*^9}, {3.703616758522071*^9, 3.703616779771031*^9}, {
   3.70361681172834*^9, 3.7036168253212223`*^9}, {3.703616860953631*^9, 
   3.703616886798388*^9}, {3.7036169264023247`*^9, 3.7036169375990763`*^9}, 
   3.703617087418556*^9, 3.703617128285171*^9, 3.7036171698653193`*^9, {
   3.7036172167707977`*^9, 3.703617256570109*^9}, 3.703617585932931*^9, {
   3.70361766851912*^9, 3.703617690806631*^9}, {3.703617720857203*^9, 
   3.703617774693095*^9}, {3.7036179879810266`*^9, 3.703618006337748*^9}, 
   3.703618124687357*^9, {3.703618224920917*^9, 3.703618234197301*^9}, 
   3.70361826518748*^9, {3.7036183289969063`*^9, 3.7036183525219193`*^9}, {
   3.703618486895587*^9, 3.703618599124633*^9}, {3.7036186356653767`*^9, 
   3.703618657470014*^9}, 3.703618886771267*^9, {3.7036189230678587`*^9, 
   3.703619033439413*^9}, {3.703619064414834*^9, 3.703619295148012*^9}, 
   3.703619367715966*^9, {3.703619405034697*^9, 3.703619431451977*^9}, {
   3.703623468646449*^9, 3.703623481774684*^9}, {3.703623595959371*^9, 
   3.703623608912237*^9}, 3.703623659669444*^9}]
}, Open  ]]
},
WindowSize->{1509, 1028},
WindowMargins->{{0, Automatic}, {0, 28}},
FrontEndVersion->"11.0 for Linux x86 (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 51141, 1165, 3219, "Input"],
Cell[51724, 1189, 14543, 255, 772, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[66304, 1449, 443, 8, 32, "Input"],
Cell[66750, 1459, 1415, 22, 23, "Message"],
Cell[68168, 1483, 16141, 283, 233, "Output"]
}, Open  ]]
}
]
*)

